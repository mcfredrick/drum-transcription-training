# Final 11-Class Drum Transcription Configuration
# Standard drum kit only - no auxiliary percussion
# Coverage: 96.58% of E-GMD dataset

# Model configuration
model:
  n_classes: 11  # Final count: standard drum kit only
  n_mels: 128
  conv_filters: [64, 128, 256]
  conv_kernel_size: 3
  pool_size: 2
  dropout_cnn: 0.25
  hidden_size: 128
  num_gru_layers: 3
  dropout_gru: 0.3
  bidirectional: true

# Class mapping (MIDI note -> class index)
class_mapping:
  # Core drums (4 classes)
  36: 0   # Kick
  38: 1   # Snare head
  40: 2   # Snare rim
  37: 3   # Side stick
  
  # Hi-hats (3 classes)
  44: 4   # Pedal hi-hat
  42: 5   # Closed hi-hat
  46: 6   # Open hi-hat
  
  # Toms (2 classes)
  43: 7   # Floor tom
  48: 8   # High-mid tom
  
  # Cymbals (2 classes)
  51: 9   # Ride
  53: 10  # Ride bell

# Reverse mapping (class index -> MIDI note)
reverse_mapping:
  0: 36   # Kick
  1: 38   # Snare head
  2: 40   # Snare rim
  3: 37   # Side stick
  4: 44   # Pedal hi-hat
  5: 42   # Closed hi-hat
  6: 46   # Open hi-hat
  7: 43   # Floor tom
  8: 48   # High-mid tom
  9: 51   # Ride
  10: 53  # Ride bell

# Human-readable names
class_names:
  0: "kick"
  1: "snare_head"
  2: "snare_rim"
  3: "side_stick"
  4: "hihat_pedal"
  5: "hihat_closed"
  6: "hihat_open"
  7: "floor_tom"
  8: "high_mid_tom"
  9: "ride"
  10: "ride_bell"

# Class frequencies (from E-GMD analysis)
class_frequencies:
  0: 387286   # Kick
  1: 355950   # Snare head
  2: 128171   # Snare rim
  3: 54221    # Side stick
  4: 242152   # Pedal hi-hat
  5: 216792   # Closed hi-hat
  6: 12513    # Open hi-hat
  7: 129908   # Floor tom
  8: 116840   # High-mid tom
  9: 197033   # Ride
  10: 14315   # Ride bell

# Class weights (inverse frequency, clipped to [0.5, 15.0])
class_weights:
  enabled: true
  weights: [0.5, 0.5, 1.5, 3.5, 0.8, 0.9, 15.0, 1.5, 1.6, 1.0, 13.0]
  # 0:  Kick          -> 0.5  (very common)
  # 1:  Snare head    -> 0.5  (very common)
  # 2:  Snare rim     -> 1.5  (common)
  # 3:  Side stick    -> 3.5  (uncommon, boost)
  # 4:  Pedal hi-hat  -> 0.8  (common)
  # 5:  Closed hi-hat -> 0.9  (common)
  # 6:  Open hi-hat   -> 15.0 (rare, boost heavily)
  # 7:  Floor tom     -> 1.5  (common)
  # 8:  High-mid tom  -> 1.6  (common)
  # 9:  Ride          -> 1.0  (common)
  # 10: Ride bell     -> 13.0 (rare, boost heavily)

# Loss function
loss:
  type: "FocalLoss"
  focal_alpha: 0.25
  focal_gamma: 2.0

# Training hyperparameters
training:
  batch_size: 16
  num_epochs: 100
  learning_rate: 0.001
  weight_decay: 0.0001
  optimizer: "Adam"
  scheduler: "ReduceLROnPlateau"
  scheduler_patience: 10
  scheduler_factor: 0.5
  gradient_clip_val: 1.0
  precision: "16-mixed"
  accumulate_grad_batches: 1

# Data paths
data:
  egmd_root: "data/e-gmd"
  processed_root: "data/processed"
  splits_dir: "data/splits"
  train_split: 0.7
  val_split: 0.15
  test_split: 0.15
  random_seed: 42

# Audio preprocessing
audio:
  sample_rate: 22050
  n_fft: 2048
  hop_length: 512
  n_mels: 128
  fmin: 30
  fmax: 11025

# Data augmentation
augmentation:
  enabled: true
  time_stretch_prob: 0.5
  time_stretch_range: [0.9, 1.1]
  pitch_shift_prob: 0.5
  pitch_shift_range: [-2, 2]
  volume_scale_prob: 0.5
  volume_scale_range: [-6, 6]
  reverb_prob: 0.3
  reverb_delay_range: [1, 3]
  reverb_attenuation_range: [0.2, 0.4]
  noise_prob: 0.3
  noise_level_range: [0.01, 0.05]

# Early stopping
early_stopping:
  enabled: true
  monitor: "val_loss"
  patience: 20
  mode: "min"
  min_delta: 0.001

# Checkpointing
checkpoint:
  monitor: "val_loss"
  save_top_k: 3
  mode: "min"
  save_last: true
  dirpath: "checkpoints"
  filename: "drum-11class-{epoch:02d}-{val_loss:.4f}"

# Logging
logging:
  logger: "wandb"
  project_name: "drum-transcription-11class"
  experiment_name: "crnn-11class-standard-kit"
  log_every_n_steps: 10
  save_dir: "logs"

# Hardware
hardware:
  devices: [0, 1]
  num_workers: 4
  accelerator: "gpu"

# Post-processing
postprocessing:
  onset_threshold: 0.5
  min_onset_interval: 0.05
  peak_min_distance: 2

# Notes
notes: |
  Final 11-class system for standard drum kit transcription.
  
  What we're transcribing:
  - Core: Kick, 3 snare articulations
  - Hi-hats: Closed, pedal, open
  - Toms: Floor, high-mid
  - Cymbals: Ride, ride bell
  
  What we dropped (3.42% of data):
  - Auxiliary percussion: tambourine, cowbell, vibraslap, hand clap
  - Duplicate cymbals: chinese, splash, ride 2, crash 1, crash 2
  - Extra toms: high tom, low tom, low-mid tom
  
  Coverage: 96.58% of E-GMD dataset
  Expected F1: 70-80%
  Perfect for rhythm game with standard drum kit expectation
