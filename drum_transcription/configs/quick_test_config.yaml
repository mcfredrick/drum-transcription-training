# Quick test configuration - Roland TD-17 mapping
# Use this for fast validation (10 files, 5 epochs, ~5-10 minutes)

data:
  egmd_root: "/mnt/hdd/drum-tranxn/e-gmd-v1.0.0"
  processed_root: "/mnt/hdd/drum-tranxn/processed_data_roland"
  splits_dir: "/mnt/hdd/drum-tranxn/processed_data_roland/splits"
  max_files: 10  # Only 10 files for quick test
  train_split: 0.7
  val_split: 0.15
  test_split: 0.15
  random_seed: 42
  midi_mapping: "roland"

audio:
  sample_rate: 22050
  n_fft: 2048
  hop_length: 512
  n_mels: 128
  fmin: 30
  fmax: 11025

model:
  name: "DrumTranscriptionCRNN_Roland"
  n_mels: 128
  n_classes: 26  # Roland TD-17
  conv_filters: [32, 64, 128, 256]
  conv_kernel_size: 3
  pool_size: 2
  dropout_cnn: 0.3
  hidden_size: 256
  num_gru_layers: 3
  dropout_gru: 0.4
  bidirectional: true

training:
  num_epochs: 5  # Quick test only
  batch_size: 4
  learning_rate: 0.00044547593667580503  # From Optuna
  optimizer: AdamW
  weight_decay: 5.559904341261682e-05
  scheduler: "ReduceLROnPlateau"
  scheduler_patience: 2
  scheduler_factor: 0.5
  gradient_clip_val: 1.0
  accumulate_grad_batches: 1
  precision: "16-mixed"

augmentation:
  enabled: false  # Disable for consistent quick tests
  time_stretch_prob: 0.0
  pitch_shift_prob: 0.0
  volume_scale_prob: 0.0
  reverb_prob: 0.0
  noise_prob: 0.0

loss:
  type: "BCELoss"
  class_weights: null

early_stopping:
  enabled: false  # Disabled for quick test
  monitor: "val_loss"
  patience: 5
  mode: "min"
  min_delta: 0.001

checkpoint:
  monitor: "val_loss"
  save_top_k: 1
  mode: "min"
  save_last: true
  dirpath: "/mnt/hdd/drum-tranxn/checkpoints_roland/quick_test"
  filename: "quick-test-{epoch:02d}-{val_loss:.4f}"

logging:
  logger: "tensorboard"
  project_name: "drum-transcription-roland-quick-test"
  experiment_name: "quick-test-validation"
  log_every_n_steps: 5
  save_dir: "/mnt/hdd/drum-tranxn/logs_roland/quick_test"

hardware:
  devices: [0]
  num_workers: 2
  accelerator: "gpu"

postprocessing:
  onset_threshold: 0.5
  min_onset_interval: 0.05
  peak_min_distance: 2

# Roland TD-17 drum mapping
roland_midi:
  drum_names: [
    "kick", "snare_head", "snare_xstick", "snare_rim",
    "tom1_head", "tom1_rim", "tom2_head", "tom2_rim",
    "tom3_head", "tom3_rim", "tom4_head", "tom4_rim",
    "hihat_closed", "hihat_closed_edge", "hihat_open", "hihat_open_edge",
    "hihat_pedal", "crash1_bow", "crash1_edge", "crash2_bow", "crash2_edge",
    "ride_bow", "ride_edge", "ride_bell", "tambourine", "cowbell"
  ]
  midi_to_class:
    36: 0   # Kick
    38: 1   # Snare Head
    37: 2   # Snare X-Stick
    40: 3   # Snare Rim
    48: 4   # Tom 1 Head
    50: 5   # Tom 1 Rim
    45: 6   # Tom 2 Head
    47: 7   # Tom 2 Rim
    43: 8   # Tom 3 Head
    58: 9   # Tom 3 Rim
    41: 10  # Tom 4 Head
    39: 11  # Tom 4 Rim
    42: 12  # Hi-Hat Closed (Bow)
    22: 13  # Hi-Hat Closed (Edge)
    46: 14  # Hi-Hat Open (Bow)
    26: 15  # Hi-Hat Open (Edge)
    44: 16  # Hi-Hat Pedal
    49: 17  # Crash 1 (Bow)
    55: 18  # Crash 1 (Edge)
    57: 19  # Crash 2 (Bow)
    52: 20  # Crash 2 (Edge)
    51: 21  # Ride (Bow)
    59: 22  # Ride (Edge)
    53: 23  # Ride Bell
    54: 24  # Tambourine
    56: 25  # Cowbell

  class_to_midi:
    0: 36   # Kick
    1: 38   # Snare Head
    2: 37   # Snare X-Stick
    3: 40   # Snare Rim
    4: 48   # Tom 1 Head
    5: 50   # Tom 1 Rim
    6: 45   # Tom 2 Head
    7: 47   # Tom 2 Rim
    8: 43   # Tom 3 Head
    9: 58   # Tom 3 Rim
    10: 41  # Tom 4 Head
    11: 39  # Tom 4 Rim
    12: 42  # Hi-Hat Closed (Bow)
    13: 22  # Hi-Hat Closed (Edge)
    14: 46  # Hi-Hat Open (Bow)
    15: 26  # Hi-Hat Open (Edge)
    16: 44  # Hi-Hat Pedal
    17: 49  # Crash 1 (Bow)
    18: 55  # Crash 1 (Edge)
    19: 57  # Crash 2 (Bow)
    20: 52  # Crash 2 (Edge)
    21: 51  # Ride (Bow)
    22: 59  # Ride (Edge)
    23: 53  # Ride Bell
    24: 54  # Tambourine
    25: 56  # Cowbell

  default_velocity: 80
  note_duration_ticks: 50
